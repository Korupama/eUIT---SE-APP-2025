# Kết nối Cơ sở dữ liệu (Database Connection)

## Các file cấu hình kết nối CSDL

### 1. File chính: `src/backend/appsettings.json`
Đây là file cấu hình chính chứa chuỗi kết nối database. File này cần được tạo từ file mẫu `appsettings.Example.json`.

**Vị trí:** `/src/backend/appsettings.json`

**Nội dung:**
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "ConnectionStrings": {
    "eUITDatabase": "Server=localhost;Port=5432;Database=eUIT;User Id=postgres;Password=YOUR_PASSWORD;"
  },
  "Jwt": {
    "Key": "YOUR_JWT_SECRET_KEY",
    "Issuer": "http://localhost:5128",
    "Audience": "http://localhost:5128"
  }
}
```

**Lưu ý:** 
- Thay `YOUR_PASSWORD` bằng mật khẩu PostgreSQL của bạn
- Thay `YOUR_JWT_SECRET_KEY` bằng key JWT của bạn
- File này **KHÔNG** được commit vào git (đã có trong .gitignore)

### 2. File sử dụng kết nối: `src/backend/Program.cs`
File này đọc chuỗi kết nối và cấu hình DbContext.

**Vị trí:** `/src/backend/Program.cs`

**Dòng quan trọng:**
```csharp
// Dòng 35: Lấy chuỗi kết nối từ appsettings.json
var connectionString = builder.Configuration.GetConnectionString("eUITDatabase");

// Dòng 38-39: Cấu hình DbContext với PostgreSQL
builder.Services.AddDbContext<eUITDbContext>(options =>
    options.UseNpgsql(connectionString));
```

### 3. File DbContext: `src/backend/Data/eUITDbContext.cs`
File này định nghĩa DbContext để làm việc với database.

**Vị trí:** `/src/backend/Data/eUITDbContext.cs`

### 4. File mẫu: `src/backend/appsettings.Example.json`
File mẫu để tham khảo cấu hình. **KHÔNG** chỉnh sửa file này trực tiếp.

## Cách thiết lập kết nối Database

### Bước 1: Tạo file cấu hình
```bash
cd src/backend
cp appsettings.Example.json appsettings.json
```

### Bước 2: Chỉnh sửa thông tin kết nối
Mở file `src/backend/appsettings.json` và chỉnh sửa:
- `Server`: Địa chỉ PostgreSQL server (mặc định: localhost)
- `Port`: Cổng PostgreSQL (mặc định: 5432)
- `Database`: Tên database (eUIT)
- `User Id`: Username PostgreSQL
- `Password`: Mật khẩu PostgreSQL

### Bước 3: Tạo database
```sql
CREATE DATABASE eUIT;
```

### Bước 4: Chạy migrations (nếu có)
```bash
cd src/backend
dotnet ef database update
```

## Cấu trúc chuỗi kết nối PostgreSQL

```
Server=<hostname>;Port=<port>;Database=<database_name>;User Id=<username>;Password=<password>;
```

**Ví dụ:**
```
Server=localhost;Port=5432;Database=eUIT;User Id=postgres;Password=mypassword;
```

## Các file liên quan khác

### Environment Variables (.env)
File `.env` có thể được sử dụng để lưu trữ các biến môi trường, bao gồm connection string.

**Vị trí:** `/.env` (root của project)

## Troubleshooting

### Lỗi: "No connection string named 'eUITDatabase' was found"
- Kiểm tra file `appsettings.json` đã tồn tại chưa
- Kiểm tra tên "eUITDatabase" trong ConnectionStrings

### Lỗi: "Could not connect to the server"
- Kiểm tra PostgreSQL đã chạy chưa
- Kiểm tra hostname, port, username, password

### Lỗi: "database 'eUIT' does not exist"
- Tạo database bằng lệnh: `CREATE DATABASE eUIT;`

## Bảo mật

⚠️ **QUAN TRỌNG:**
- **KHÔNG** commit file `appsettings.json` vào git
- **KHÔNG** chia sẻ mật khẩu database
- Sử dụng environment variables cho production
- Thay đổi JWT Key mặc định

## English Version

# Database Connection

## Configuration Files for Database Connection

### 1. Main File: `src/backend/appsettings.json`
This is the main configuration file containing the database connection string. This file needs to be created from the example file `appsettings.Example.json`.

**Location:** `/src/backend/appsettings.json`

### 2. Connection Usage: `src/backend/Program.cs`
This file reads the connection string and configures the DbContext.

**Location:** `/src/backend/Program.cs`

**Key lines (35-39):**
- Gets connection string from appsettings.json
- Configures DbContext with PostgreSQL

### 3. DbContext File: `src/backend/Data/eUITDbContext.cs`
Defines the DbContext for database operations.

### 4. Example File: `src/backend/appsettings.Example.json`
Template file for reference. Do NOT edit this file directly.

## Setup Instructions

1. Copy the example file: `cp appsettings.Example.json appsettings.json`
2. Edit connection string in `appsettings.json`
3. Create database: `CREATE DATABASE eUIT;`
4. Run migrations: `dotnet ef database update`

## Security Notes

⚠️ **IMPORTANT:**
- DO NOT commit `appsettings.json` to git
- DO NOT share database passwords
- Use environment variables for production
- Change the default JWT Key
